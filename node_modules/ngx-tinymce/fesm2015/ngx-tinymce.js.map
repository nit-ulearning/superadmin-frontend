{"version":3,"file":"ngx-tinymce.js","sources":["../../lib/src/tinymce.options.ts","../../lib/src/tinymce.component.ts","../../lib/src/tinymce.module.ts","../../lib/ngx-tinymce.ts"],"sourcesContent":["export class TinymceOptions {\n  /** 指定tinymce目录路径，默认：`./assets/tinymce/` */\n  baseURL?: string = './assets/tinymce/';\n  /** 指定tinymce文件名，默认：`tinymce.min.js` */\n  fileName?: string = 'tinymce.min.js';\n  /** 默认配置项，对全局 Tinymce 有效 */\n  config?: any;\n  /** 延迟加载（单位：毫秒），默认：`0` */\n  delay?: number;\n}\n","import {\n  Component,\n  forwardRef,\n  OnChanges,\n  OnDestroy,\n  Input,\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  TemplateRef,\n  SimpleChanges,\n  ViewEncapsulation,\n  Output,\n  EventEmitter,\n  NgZone,\n  Inject,\n} from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\nimport { InputBoolean, InputNumber } from '@ng-util/util';\nimport { NuLazyService } from '@ng-util/lazy';\nimport { TinymceOptions } from './tinymce.options';\nimport { DOCUMENT } from '@angular/common';\n\nconst isSSR = !(typeof document === 'object' && !!document);\n\n@Component({\n  selector: 'tinymce',\n  exportAs: 'tinymce',\n  template: `\n    <textarea *ngIf=\"!inline\" [attr.id]=\"id\" [attr.placeholder]=\"placeholder\" class=\"tinymce-selector\"></textarea>\n    <div *ngIf=\"inline\" [attr.id]=\"id\"><ng-content></ng-content></div>\n    <div class=\"loading\" *ngIf=\"load\">\n      <ng-container *ngIf=\"_loading; else _loadingTpl\">{{ _loading }}</ng-container>\n    </div>\n  `,\n  styles: [\n    `\n      tinymce .tinymce-selector {\n        display: none;\n      }\n    `,\n  ],\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => TinymceComponent),\n      multi: true,\n    },\n  ],\n  preserveWhitespaces: false,\n  encapsulation: ViewEncapsulation.None,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TinymceComponent implements AfterViewInit, OnChanges, OnDestroy, ControlValueAccessor {\n  static ngAcceptInputType_inline: string | boolean | null | undefined;\n  static ngAcceptInputType_disabled: string | boolean | null | undefined;\n  static ngAcceptInputType_delay: string | number | null | undefined;\n\n  private _instance: any;\n  private value = '';\n  load = true;\n  id = `_tinymce-${Math.random().toString(36).substring(2)}`;\n\n  private onChange!: (value: string) => void;\n  private onTouched!: () => void;\n\n  @Input() config: any;\n  @Input() placeholder = '';\n  @Input() @InputBoolean() inline = false;\n  @Input()\n  @InputBoolean()\n  set disabled(value: boolean) {\n    this._disabled = value;\n    this.setDisabled();\n  }\n  private _disabled = false;\n\n  _loading: string | null = null;\n  _loadingTpl: TemplateRef<any> | null = null;\n  @Input()\n  set loading(value: string | TemplateRef<any>) {\n    if (value instanceof TemplateRef) {\n      this._loading = null;\n      this._loadingTpl = value;\n    } else {\n      this._loading = value;\n    }\n  }\n  /** 延迟初始化 */\n  @Input() @InputNumber() delay = 0;\n  @Output() ready = new EventEmitter<any>();\n\n  get instance(): any {\n    return this._instance;\n  }\n\n  private _getWin(): any {\n    return this.doc.defaultView || window;\n  }\n\n  constructor(\n    private defConfig: TinymceOptions,\n    private lazySrv: NuLazyService,\n    private ngZone: NgZone,\n    @Inject(DOCUMENT) private doc: any,\n    private cd: ChangeDetectorRef,\n  ) {}\n\n  private initDelay(): void {\n    if (isSSR) {\n      return;\n    }\n    setTimeout(() => this.init(), Math.min(0, this.delay));\n  }\n\n  private init(): void {\n    const win = this._getWin();\n    if (!win.tinymce) {\n      throw new Error('tinymce js文件加载失败');\n    }\n\n    const { defConfig, config, id, inline } = this;\n    if (this._instance) {\n      return;\n    }\n\n    if (defConfig.baseURL) {\n      let url = '' + defConfig.baseURL;\n      if (url.endsWith('/')) {\n        url = url.substr(0, url.length - 1);\n      }\n      win.tinymce.baseURL = url;\n    }\n    const userOptions = { ...defConfig.config, ...config };\n    const options = {\n      selector: `#` + id,\n      inline,\n      ...defConfig.config,\n      ...config,\n\n      setup: (editor: any) => {\n        this._instance = editor;\n        if (this.onChange) {\n          editor.on('change keyup', () => {\n            this.value = editor.getContent();\n            this.ngZone.run(() => this.onChange(this.value));\n          });\n        }\n        if (typeof userOptions.setup === 'function') {\n          userOptions.setup(editor);\n        }\n      },\n      init_instance_callback: (editor: any) => {\n        if (editor && this.value) {\n          editor.setContent(this.value);\n        }\n        this.setDisabled();\n        if (typeof userOptions.init_instance_callback === 'function') {\n          userOptions.init_instance_callback(editor);\n        }\n        this.ready.emit(this._instance);\n      },\n    };\n    if (userOptions.auto_focus) {\n      options.auto_focus = id;\n    }\n\n    this.ngZone.runOutsideAngular(() => win.tinymce.init(options));\n\n    this.load = false;\n    this.cd.detectChanges();\n  }\n\n  private destroy(): void {\n    if (!this._instance) {\n      return;\n    }\n    this.ngZone.runOutsideAngular(() => {\n      this._instance.off();\n      this._instance.remove('#' + this.id);\n    });\n    this._instance = null;\n  }\n\n  private setDisabled(): void {\n    if (!this._instance) {\n      return;\n    }\n    this.ngZone.runOutsideAngular(() => this._instance.setMode(this._disabled ? 'readonly' : 'design'));\n  }\n\n  ngAfterViewInit(): void {\n    if (isSSR) {\n      return;\n    }\n    // 已经存在对象无须进入懒加载模式\n    if (this._getWin().tinymce) {\n      this.initDelay();\n      return;\n    }\n\n    const { defConfig } = this;\n    const baseURL = defConfig && defConfig.baseURL;\n    const fileName = defConfig && defConfig.fileName;\n    const url = (baseURL || './assets/tinymce/') + (fileName || 'tinymce.min.js');\n    this.lazySrv.monitor(url).subscribe(() => this.initDelay());\n    this.lazySrv.load(url);\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (this._instance && changes.config) {\n      this.destroy();\n      this.initDelay();\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.destroy();\n  }\n\n  writeValue(value: string): void {\n    // value should be NOT NULL\n    this.value = value || '';\n    if (this._instance) {\n      this.ngZone.runOutsideAngular(() => this._instance.setContent(this.value));\n    }\n  }\n\n  registerOnChange(fn: (_: any) => {}): void {\n    this.onChange = fn;\n  }\n  registerOnTouched(fn: () => {}): void {\n    this.onTouched = fn;\n  }\n\n  setDisabledState(isDisabled: boolean): void {\n    this.disabled = isDisabled;\n    this.setDisabled();\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { TinymceOptions } from './tinymce.options';\nimport { TinymceComponent } from './tinymce.component';\n\n@NgModule({\n  imports: [CommonModule],\n  declarations: [TinymceComponent],\n  exports: [TinymceComponent],\n})\nexport class NgxTinymceModule {\n  static forRoot(options: TinymceOptions): ModuleWithProviders<NgxTinymceModule> {\n    return {\n      ngModule: NgxTinymceModule,\n      providers: [{ provide: TinymceOptions, useValue: options }],\n    };\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}